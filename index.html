<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TanhuStok â€” POS Sistemi</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Rajdhani:wght@400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <!-- QuaggaJS - Barkod Okuma -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
    <!-- SheetJS - Excel Ä°ÅŸlemleri -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Rajdhani:wght@400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap');

        :root {
            --bg:        #0b0e14;
            --bg2:       #12171f;
            --bg3:       #1a2030;
            --gold:      #f0a500;
            --gold2:     #ffc94a;
            --gold-dim:  rgba(240,165,0,0.15);
            --red:       #e03e3e;
            --green:     #22c55e;
            --blue:      #3b82f6;
            --text:      #e8eaf0;
            --text-dim:  #8892a4;
            --border:    rgba(255,255,255,0.07);
            --radius:    12px;
        }

        * { margin:0; padding:0; box-sizing:border-box; }

        body {
            font-family: 'Rajdhani', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }

        /* â”€â”€â”€ LOGIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .login-screen {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            background: var(--bg);
            position: relative;
            overflow: hidden;
        }

        /* Arka plan geometrik desen */
        .login-screen::before {
            content: '';
            position: absolute;
            inset: 0;
            background:
                repeating-linear-gradient(0deg, transparent, transparent 59px, rgba(240,165,0,0.04) 60px),
                repeating-linear-gradient(90deg, transparent, transparent 59px, rgba(240,165,0,0.04) 60px);
            pointer-events: none;
        }

        .login-screen::after {
            content: '';
            position: absolute;
            width: 600px; height: 600px;
            background: radial-gradient(circle, rgba(240,165,0,0.08) 0%, transparent 70%);
            top: 50%; left: 50%;
            transform: translate(-50%, -60%);
            pointer-events: none;
        }

        /* TanhuStok Logo / Amblem */
        .tanhu-logo {
            position: relative;
            z-index: 1;
            text-align: center;
            margin-bottom: 40px;
            animation: logoReveal 0.8s ease forwards;
        }

        @keyframes logoReveal {
            from { opacity:0; transform: translateY(-20px) scale(0.95); }
            to   { opacity:1; transform: translateY(0) scale(1); }
        }

        .tanhu-emblem {
            width: 100px;
            height: 100px;
            margin: 0 auto 20px;
            position: relative;
        }

        .tanhu-brand {
            font-family: 'Bebas Neue', cursive;
            font-size: 64px;
            letter-spacing: 6px;
            line-height: 1;
            background: linear-gradient(135deg, #f0a500 0%, #ffd700 50%, #e07b00 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: none;
            filter: drop-shadow(0 0 30px rgba(240,165,0,0.4));
        }

        .tanhu-sub {
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            letter-spacing: 8px;
            color: var(--text-dim);
            text-transform: uppercase;
            margin-top: 6px;
        }

        .tanhu-divider {
            width: 200px;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--gold), transparent);
            margin: 20px auto;
        }

        /* Login form */
        .login-form {
            position: relative;
            z-index: 1;
            width: 100%;
            max-width: 380px;
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 32px;
            backdrop-filter: blur(10px);
            animation: formReveal 0.8s 0.2s ease both;
        }

        @keyframes formReveal {
            from { opacity:0; transform: translateY(20px); }
            to   { opacity:1; transform: translateY(0); }
        }

        .input-group { margin-bottom: 16px; }

        .input-group input {
            width: 100%;
            padding: 14px 16px;
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-family: 'Rajdhani', sans-serif;
            font-size: 16px;
            font-weight: 500;
            transition: border-color 0.2s, box-shadow 0.2s;
            outline: none;
        }

        .input-group input::placeholder { color: var(--text-dim); }

        .input-group input:focus {
            border-color: var(--gold);
            box-shadow: 0 0 0 3px rgba(240,165,0,0.12);
        }

        .btn-login {
            width: 100%;
            padding: 14px;
            background: var(--gold);
            color: #0b0e14;
            border: none;
            border-radius: 8px;
            font-family: 'Bebas Neue', cursive;
            font-size: 20px;
            letter-spacing: 3px;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 8px;
        }

        .btn-login:hover {
            background: var(--gold2);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(240,165,0,0.3);
        }

        /* â”€â”€â”€ APP LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .app-container { display: none; min-height: 100vh; flex-direction: column; }
        .app-container.visible { display: flex; }

        .app-header {
            background: var(--bg2);
            border-bottom: 1px solid var(--border);
            padding: 0 24px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .app-header-brand {
            font-family: 'Bebas Neue', cursive;
            font-size: 28px;
            letter-spacing: 4px;
            background: linear-gradient(135deg, #f0a500, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .db-status-bar {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 2px;
        }

        #dbDurum {
            font-size: 11px;
            color: var(--text-dim);
            font-family: 'JetBrains Mono', monospace;
        }

        #kayitDurum {
            font-size: 11px;
            font-family: 'JetBrains Mono', monospace;
        }

        .header-btn-group { display: flex; gap: 6px; }

        .hbtn {
            padding: 6px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: transparent;
            color: var(--text);
            font-family: 'Rajdhani', sans-serif;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .hbtn:hover { border-color: var(--gold); color: var(--gold); }
        .hbtn.green { border-color: rgba(34,197,94,0.4); color: var(--green); }
        .hbtn.green:hover { background: rgba(34,197,94,0.1); }
        .hbtn.gold { border-color: rgba(240,165,0,0.4); color: var(--gold); }
        .hbtn.gold:hover { background: rgba(240,165,0,0.1); }

        .current-user-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: var(--bg3);
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text);
        }

        .user-dot {
            width: 8px; height: 8px;
            background: var(--green);
            border-radius: 50%;
            box-shadow: 0 0 6px var(--green);
        }

        .btn-logout {
            padding: 6px 12px;
            background: transparent;
            border: 1px solid rgba(224,62,62,0.4);
            border-radius: 6px;
            color: var(--red);
            font-family: 'Rajdhani', sans-serif;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-logout:hover { background: rgba(224,62,62,0.1); }

        /* â”€â”€â”€ DASHBOARD NAV CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .main-nav { display: none; } /* Eski nav gizle */

        .dashboard-nav {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 12px;
            padding: 20px 24px;
            background: var(--bg2);
            border-bottom: 1px solid var(--border);
            flex-shrink: 0;
        }

        .dash-nav-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 16px 8px;
            background: var(--bg3);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }

        .dash-nav-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, var(--gold-dim), transparent);
            opacity: 0;
            transition: opacity 0.2s;
        }

        .dash-nav-card:hover::before,
        .dash-nav-card.active::before { opacity: 1; }

        .dash-nav-card:hover,
        .dash-nav-card.active {
            border-color: rgba(240,165,0,0.5);
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(240,165,0,0.12);
        }

        .dash-nav-card.active {
            border-color: var(--gold);
        }

        .dash-nav-icon {
            font-size: 26px;
            line-height: 1;
            position: relative;
            z-index: 1;
        }

        .dash-nav-label {
            font-family: 'Rajdhani', sans-serif;
            font-size: 13px;
            font-weight: 700;
            letter-spacing: 0.5px;
            color: var(--text-dim);
            text-align: center;
            line-height: 1.2;
            position: relative;
            z-index: 1;
            transition: color 0.2s;
        }

        .dash-nav-card:hover .dash-nav-label,
        .dash-nav-card.active .dash-nav-label {
            color: var(--gold);
        }

        .dash-nav-active-bar {
            position: absolute;
            bottom: 0; left: 0; right: 0;
            height: 3px;
            background: var(--gold);
            transform: scaleX(0);
            transition: transform 0.2s;
            border-radius: 2px 2px 0 0;
        }

        .dash-nav-card.active .dash-nav-active-bar { transform: scaleX(1); }

        /* â”€â”€â”€ CONTENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .content-area {
            padding: 24px;
            flex: 1;
            overflow-y: auto;
        }

        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.25s ease; }

        @keyframes fadeIn {
            from { opacity:0; transform: translateY(6px); }
            to   { opacity:1; transform: translateY(0); }
        }

        /* â”€â”€â”€ CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .card {
            background: var(--bg2);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 16px;
        }

        .card-header {
            font-family: 'Rajdhani', sans-serif;
            font-size: 18px;
            font-weight: 700;
            letter-spacing: 1px;
            color: var(--text);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 14px;
            border-bottom: 1px solid var(--border);
        }

        /* â”€â”€â”€ STATS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            margin-bottom: 16px;
        }

        .stat-card {
            background: var(--bg3);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .stat-card::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 3px;
            background: var(--gold);
        }

        .stat-card.success::after { background: var(--green); }
        .stat-card.warning::after { background: #f59e0b; }
        .stat-card.danger::after  { background: var(--red); }

        .stat-label {
            font-size: 12px;
            font-weight: 600;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--text-dim);
            margin-bottom: 8px;
        }

        .stat-value {
            font-family: 'Bebas Neue', cursive;
            font-size: 36px;
            letter-spacing: 2px;
            color: var(--text);
            line-height: 1;
        }

        /* â”€â”€â”€ FORMS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 14px;
            margin-bottom: 16px;
        }

        .form-group { display: flex; flex-direction: column; gap: 6px; }

        .form-group label {
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--text-dim);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 10px 14px;
            background: var(--bg3);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-family: 'Rajdhani', sans-serif;
            font-size: 15px;
            font-weight: 500;
            outline: none;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder { color: var(--text-dim); }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: var(--gold);
            box-shadow: 0 0 0 3px rgba(240,165,0,0.1);
        }

        .form-group select option { background: var(--bg2); }

        /* â”€â”€â”€ BUTTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            font-family: 'Rajdhani', sans-serif;
            font-size: 14px;
            font-weight: 700;
            letter-spacing: 0.5px;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary { background: var(--blue); color: #fff; }
        .btn-primary:hover { background: #2563eb; transform: translateY(-1px); }

        .btn-success { background: #16a34a; color: #fff; }
        .btn-success:hover { background: #15803d; transform: translateY(-1px); }

        .btn-danger { background: #dc2626; color: #fff; }
        .btn-danger:hover { background: #b91c1c; transform: translateY(-1px); }

        .btn-warning { background: #d97706; color: #fff; }
        .btn-warning:hover { background: #b45309; transform: translateY(-1px); }

        .btn-secondary { background: var(--bg3); color: var(--text); border: 1px solid var(--border); }
        .btn-secondary:hover { border-color: var(--gold); color: var(--gold); }

        .btn-group { display: flex; gap: 8px; flex-wrap: wrap; }

        /* â”€â”€â”€ TABLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .table-container { overflow-x: auto; margin-top: 16px; }

        table { width: 100%; border-collapse: collapse; }

        th {
            padding: 10px 12px;
            text-align: left;
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--text-dim);
            background: var(--bg3);
            border-bottom: 1px solid var(--border);
        }

        td {
            padding: 11px 12px;
            border-bottom: 1px solid var(--border);
            font-size: 14px;
            font-weight: 500;
        }

        tr:hover td { background: rgba(255,255,255,0.02); }

        /* â”€â”€â”€ CART â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: var(--bg3);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .cart-item-name { font-weight: 700; font-size: 15px; margin-bottom: 4px; }
        .cart-item-price { font-size: 13px; color: var(--text-dim); }

        .cart-item-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .qty-btn {
            width: 28px; height: 28px;
            border: 1px solid var(--border);
            background: var(--bg2);
            color: var(--text);
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;
        }

        .qty-btn:hover { border-color: var(--gold); color: var(--gold); }

        .cart-total {
            background: var(--bg3);
            border: 1px solid rgba(240,165,0,0.3);
            border-radius: var(--radius);
            padding: 20px;
            text-align: center;
            margin: 16px 0;
        }

        .cart-total-label {
            font-size: 12px;
            letter-spacing: 3px;
            text-transform: uppercase;
            color: var(--text-dim);
            font-family: 'JetBrains Mono', monospace;
            margin-bottom: 8px;
        }

        .cart-total-value {
            font-family: 'Bebas Neue', cursive;
            font-size: 48px;
            letter-spacing: 3px;
            color: var(--gold);
            line-height: 1;
        }

        /* â”€â”€â”€ BADGES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .badge-success { background: rgba(34,197,94,0.15); color: #4ade80; border: 1px solid rgba(34,197,94,0.3); }
        .badge-warning { background: rgba(245,158,11,0.15); color: #fbbf24; border: 1px solid rgba(245,158,11,0.3); }
        .badge-danger  { background: rgba(224,62,62,0.15);  color: #f87171; border: 1px solid rgba(224,62,62,0.3); }

        /* â”€â”€â”€ MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .modal {
            display: none;
            position: fixed; inset: 0;
            background: rgba(0,0,0,0.75);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(4px);
        }

        .modal.active { display: flex; }

        .modal-content {
            background: var(--bg2);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 28px;
            max-width: 520px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            font-family: 'Rajdhani', sans-serif;
            font-size: 20px;
            font-weight: 700;
            letter-spacing: 1px;
            margin-bottom: 20px;
            color: var(--gold);
        }

        .modal-footer {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        /* â”€â”€â”€ SEARCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .search-box { position: relative; margin-bottom: 16px; }

        .search-box input {
            width: 100%;
            padding: 10px 40px 10px 14px;
            background: var(--bg3);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-family: 'Rajdhani', sans-serif;
            font-size: 15px;
            outline: none;
            transition: border-color 0.2s;
        }

        .search-box input:focus { border-color: var(--gold); }
        .search-box::after { content: 'ğŸ”'; position: absolute; right: 12px; top: 50%; transform: translateY(-50%); pointer-events: none; }

        /* â”€â”€â”€ ALERTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .alert {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 14px;
            font-weight: 600;
        }

        .alert-success { background: rgba(34,197,94,0.1); border: 1px solid rgba(34,197,94,0.3); color: #4ade80; }
        .alert-danger  { background: rgba(224,62,62,0.1);  border: 1px solid rgba(224,62,62,0.3);  color: #f87171; }
        .alert-warning { background: rgba(245,158,11,0.1); border: 1px solid rgba(245,158,11,0.3); color: #fbbf24; }

        /* â”€â”€â”€ SCANNER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .scanner-overlay {
            display: none;
            position: fixed; inset: 0;
            background: rgba(0,0,0,0.92);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .scanner-overlay.active { display: flex; }

        .scanner-container {
            width: 100%; max-width: 600px;
            background: var(--bg2);
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
        }

        .scanner-header {
            background: var(--gold);
            color: #0b0e14;
            padding: 16px 20px;
            text-align: center;
            font-family: 'Bebas Neue', cursive;
            font-size: 22px;
            letter-spacing: 3px;
        }

        #scanner-viewport { width: 100%; height: 380px; position: relative; }
        #scanner-viewport video { width: 100%; height: 100%; object-fit: cover; }
        #scanner-viewport canvas { position: absolute; top: 0; left: 0; }

        .scanner-line {
            position: absolute;
            width: 80%; height: 2px;
            background: var(--gold);
            left: 10%; top: 50%;
            animation: scan 2s ease-in-out infinite;
            box-shadow: 0 0 10px var(--gold);
        }

        @keyframes scan {
            0%, 100% { top: 30%; }
            50% { top: 70%; }
        }

        .scanner-footer { padding: 16px; text-align: center; }

        /* â”€â”€â”€ FILE UPLOAD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .file-upload-area {
            border: 2px dashed var(--border);
            border-radius: 10px;
            padding: 24px;
            text-align: center;
            margin: 16px 0;
            cursor: pointer;
            transition: all 0.2s;
        }

        .file-upload-area:hover {
            border-color: var(--gold);
            background: var(--gold-dim);
        }

        /* â”€â”€â”€ FÄ°Å â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .fis-container {
            max-width: 380px; margin: 0 auto;
            background: white; color: #111;
            padding: 24px;
            border: 2px dashed #333;
            font-family: 'Courier New', monospace;
        }

        .fis-header { text-align: center; border-bottom: 2px dashed #333; padding-bottom: 12px; margin-bottom: 12px; }
        .fis-logo { font-size: 20px; font-weight: bold; margin-bottom: 8px; }
        .fis-bilgi { font-size: 11px; line-height: 1.6; }
        .fis-tarih { display: flex; justify-content: space-between; font-size: 11px; margin: 12px 0; padding: 8px 0; border-top: 1px dashed #666; border-bottom: 1px dashed #666; }
        .fis-urunler { margin: 12px 0; }
        .fis-urun { display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 8px; padding: 6px 0; font-size: 11px; border-bottom: 1px dotted #999; }
        .fis-urun-ad { font-weight: bold; }
        .fis-toplam { margin-top: 12px; padding-top: 12px; border-top: 2px dashed #333; }
        .fis-toplam-satir { display: flex; justify-content: space-between; padding: 4px 0; font-size: 12px; }
        .fis-toplam-satir.grand { font-size: 16px; font-weight: bold; padding: 8px 0; border-top: 2px solid #333; margin-top: 8px; }
        .fis-footer { text-align: center; margin-top: 16px; padding-top: 12px; border-top: 2px dashed #333; font-size: 10px; line-height: 1.8; }
        .fis-tesekkur { font-weight: bold; font-size: 13px; margin: 12px 0; }

        /* â”€â”€â”€ HIDDEN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .hidden { display: none !important; }

        /* â”€â”€â”€ SCROLLBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg); }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(240,165,0,0.4); }

        /* â”€â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        @media (max-width: 900px) {
            .dashboard-nav { grid-template-columns: repeat(3, 1fr); }
        }

        @media (max-width: 600px) {
            .dashboard-nav { grid-template-columns: repeat(2, 1fr); gap: 8px; padding: 12px; }
            .content-area { padding: 12px; }
            .app-header { padding: 0 12px; }
        }

        @media print {
            body * { visibility: hidden; }
            .fis-container, .fis-container * { visibility: visible; }
            .fis-container { position: absolute; left: 0; top: 0; border: none; }
            .modal-footer { display: none; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Screen -->
        <div id="loginScreen" class="login-screen">
            <div class="tanhu-logo">
                <!-- Geometrik amblem SVG -->
                <div class="tanhu-emblem">
                    <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg" width="100" height="100">
                        <!-- DÄ±ÅŸ altÄ±gen -->
                        <polygon points="50,4 93,27 93,73 50,96 7,73 7,27" stroke="#f0a500" stroke-width="2" fill="none" opacity="0.6"/>
                        <!-- Ä°Ã§ altÄ±gen -->
                        <polygon points="50,16 82,33 82,67 50,84 18,67 18,33" stroke="#f0a500" stroke-width="1.5" fill="rgba(240,165,0,0.05)" opacity="0.8"/>
                        <!-- Merkez T harfi stili -->
                        <line x1="35" y1="35" x2="65" y2="35" stroke="#f0a500" stroke-width="4" stroke-linecap="round"/>
                        <line x1="50" y1="35" x2="50" y2="65" stroke="#f0a500" stroke-width="4" stroke-linecap="round"/>
                        <!-- KÃ¶ÅŸe noktalar -->
                        <circle cx="50" cy="4"  r="3" fill="#f0a500"/>
                        <circle cx="93" cy="27" r="3" fill="#f0a500"/>
                        <circle cx="93" cy="73" r="3" fill="#f0a500"/>
                        <circle cx="50" cy="96" r="3" fill="#f0a500"/>
                        <circle cx="7"  cy="73" r="3" fill="#f0a500"/>
                        <circle cx="7"  cy="27" r="3" fill="#f0a500"/>
                        <!-- Merkez nokta -->
                        <circle cx="50" cy="50" r="4" fill="#f0a500" opacity="0.8"/>
                        <!-- IÅŸÄ±ma Ã§izgileri -->
                        <line x1="50" y1="16" x2="50" y2="22" stroke="#f0a500" stroke-width="1.5" opacity="0.5"/>
                        <line x1="50" y1="78" x2="50" y2="84" stroke="#f0a500" stroke-width="1.5" opacity="0.5"/>
                    </svg>
                </div>
                <div class="tanhu-brand">TanhuStok</div>
                <div class="tanhu-sub">Birlik POS Sistemi</div>
                <div class="tanhu-divider"></div>
            </div>

            <div class="login-form">
                <div class="input-group">
                    <input type="text" id="loginUsername" placeholder="KullanÄ±cÄ± AdÄ±" autocomplete="username">
                </div>
                <div class="input-group">
                    <input type="password" id="loginPassword" placeholder="Åifre" autocomplete="current-password">
                </div>
                <button class="btn-login" onclick="login()">GÄ°RÄ°Å YAP</button>
            </div>
        </div>

        <!-- Main App -->
        <div id="appContainer" class="app-container">
            <!-- Header -->
            <div class="app-header">
                <div class="app-header-brand">TanhuStok</div>
                <div class="user-info">
                    <div class="db-status-bar">
                        <span id="dbDurum">â³ YÃ¼kleniyor...</span>
                        <span id="kayitDurum"></span>
                    </div>
                    <div class="header-btn-group">
                        <button class="hbtn green" onclick="excelDosyaAc()">ğŸ“‚ YÃ¼kle</button>
                        <button class="hbtn gold"  onclick="excelKaydet()">ğŸ’¾ Kaydet</button>
                    </div>
                    <div class="current-user-badge">
                        <span class="user-dot"></span>
                        <span id="currentUser">Admin</span>
                    </div>
                    <button class="btn-logout" onclick="logout()">Ã‡Ä±kÄ±ÅŸ</button>
                </div>
            </div>

            <!-- Dashboard Navigation Cards -->
            <div class="dashboard-nav">
                <div class="dash-nav-card active" onclick="switchTab('hizliKasa', this)">
                    <div class="dash-nav-icon">ğŸ›’</div>
                    <div class="dash-nav-label">HÄ±zlÄ± Kasa</div>
                    <div class="dash-nav-active-bar"></div>
                </div>
                <div class="dash-nav-card" onclick="switchTab('stokYonetim', this)">
                    <div class="dash-nav-icon">ğŸ“¦</div>
                    <div class="dash-nav-label">Stok YÃ¶netimi</div>
                    <div class="dash-nav-active-bar"></div>
                </div>
                <div class="dash-nav-card" onclick="switchTab('musteriYonetim', this)">
                    <div class="dash-nav-icon">ğŸ‘¥</div>
                    <div class="dash-nav-label">MÃ¼ÅŸteri YÃ¶netimi</div>
                    <div class="dash-nav-active-bar"></div>
                </div>
                <div class="dash-nav-card" onclick="switchTab('personelYonetim', this)">
                    <div class="dash-nav-icon">ğŸ‘”</div>
                    <div class="dash-nav-label">Personel YÃ¶netimi</div>
                    <div class="dash-nav-active-bar"></div>
                </div>
                <div class="dash-nav-card" onclick="switchTab('gunSonu', this)">
                    <div class="dash-nav-icon">ğŸ</div>
                    <div class="dash-nav-label">GÃ¼n Sonu</div>
                    <div class="dash-nav-active-bar"></div>
                </div>
                <div class="dash-nav-card" onclick="switchTab('raporlar', this)">
                    <div class="dash-nav-icon">ğŸ“ˆ</div>
                    <div class="dash-nav-label">Raporlar</div>
                    <div class="dash-nav-active-bar"></div>
                </div>
            </div>

            <!-- Eski nav - gizli kalacak -->
            <div class="main-nav" style="display:none">
                <button class="nav-btn active" onclick="switchTab('hizliKasa', this)">ğŸ›’ HÄ±zlÄ± Kasa</button>
                <button class="nav-btn" onclick="switchTab('stokYonetim', this)">ğŸ“¦ Stok YÃ¶netimi</button>
                <button class="nav-btn" onclick="switchTab('musteriYonetim', this)">ğŸ‘¥ MÃ¼ÅŸteri YÃ¶netimi</button>
                <button class="nav-btn" onclick="switchTab('personelYonetim', this)">ğŸ‘” Personel YÃ¶netimi</button>
                <button class="nav-btn" onclick="switchTab('gunSonu', this)">ğŸ GÃ¼n Sonu</button>
                <button class="nav-btn" onclick="switchTab('raporlar', this)">ğŸ“ˆ Raporlar</button>
            </div>

            <!-- Content Area -->
            <div class="content-area">
                <!-- HÄ±zlÄ± Kasa Tab -->
                <div id="hizliKasa" class="tab-content active">
                    <div class="card">
                        <div class="card-header">
                            <span>ğŸ›’ HÄ±zlÄ± SatÄ±ÅŸ</span>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label>Barkod / ÃœrÃ¼n Ara</label>
                                <input type="text" id="barkodInput" placeholder="Barkod okutun veya Ã¼rÃ¼n adÄ± girin">
                            </div>
                            <div class="form-group">
                                <label>MÃ¼ÅŸteri SeÃ§</label>
                                <select id="kasaMusteriSelect">
                                    <option value="">MÃ¼ÅŸteri SeÃ§in</option>
                                </select>
                            </div>
                        </div>

                        <div class="btn-group" style="margin-bottom: 20px;">
                            <button class="btn btn-primary" onclick="barkodOkuyucuAc('kasa')">ğŸ“· BARKOD OKUT</button>
                        </div>

                        <div id="sepetListesi"></div>

                        <div class="cart-total">
                            <div class="cart-total-label">TOPLAM TUTAR</div>
                            <div class="cart-total-value"><span id="sepetToplam">0.00</span> â‚º</div>
                        </div>

                        <div class="btn-group">
                            <button class="btn btn-success" onclick="odemeTamamla('nakit')">ğŸ’µ NAKÄ°T Ã–DE</button>
                            <button class="btn btn-primary" onclick="odemeTamamla('kredi')">ğŸ’³ KREDÄ° KARTI</button>
                            <button class="btn btn-warning" onclick="odemeTamamla('veresiye')">ğŸ“‹ VERESÄ°YE</button>
                            <button class="btn btn-danger" onclick="sepetTemizle()">ğŸ—‘ï¸ SEPETÄ° TEMÄ°ZLE</button>
                        </div>
                    </div>
                </div>

                <!-- Stok YÃ¶netimi Tab -->
                <div id="stokYonetim" class="tab-content">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Toplam ÃœrÃ¼n</div>
                            <div class="stat-value" id="toplamUrun">0</div>
                        </div>
                        <div class="stat-card success">
                            <div class="stat-label">Stok DeÄŸeri</div>
                            <div class="stat-value" id="stokDegeri">0â‚º</div>
                        </div>
                        <div class="stat-card warning">
                            <div class="stat-label">Kritik Stok</div>
                            <div class="stat-value" id="kritikStok">0</div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span>ğŸ“¦ ÃœrÃ¼n Ekle / DÃ¼zenle</span>
                            <div class="btn-group">
                                <button class="btn btn-success" onclick="excelYukle()">ğŸ“¥ EXCEL YÃœKLE</button>
                                <button class="btn btn-warning" onclick="excelIndir('stok')">ğŸ“¤ EXCEL Ä°NDÄ°R</button>
                                <button class="btn btn-primary" onclick="stokFormuGoster()">â• Yeni ÃœrÃ¼n</button>
                            </div>
                        </div>

                        <!-- Excel YÃ¼kleme AlanÄ± -->
                        <div id="excelYuklemeAlani" class="hidden">
                            <div style="padding: 20px 0;">
                                <input type="file" id="excelFileInput" accept=".xlsx,.xls" style="display:none;" onchange="excelDosyasiSec(event)">
                                <p style="color: #6b7280; margin-bottom: 15px; font-size: 14px;">
                                    ğŸ“‹ SÃ¼tun SÄ±rasÄ±: <strong>Barkod | ÃœrÃ¼n AdÄ± | Kategori | AlÄ±ÅŸ FiyatÄ± | SatÄ±ÅŸ FiyatÄ± | Stok | Kritik Stok | Birim</strong>
                                </p>
                                <div class="btn-group">
                                    <button type="button" class="btn btn-primary" onclick="document.getElementById('excelFileInput').click()">
                                        ğŸ“‚ Dosya SeÃ§ (GÃ¶zat)
                                    </button>
                                    <button type="button" class="btn btn-secondary" onclick="excelYuklemeIptal()">âŒ Ä°ptal</button>
                                </div>
                                <div id="seciliDosyaAdi" style="margin-top: 12px; color: #6b7280; font-size: 14px;"></div>
                            </div>
                        </div>

                        <div id="stokFormu" class="hidden">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>Barkod</label>
                                    <div style="display: flex; gap: 10px;">
                                        <input type="text" id="urunBarkod" placeholder="Barkod numarasÄ±" style="flex: 1;">
                                        <button class="btn btn-primary" onclick="barkodOkuyucuAc('stok')" style="padding: 12px 16px;">ğŸ“·</button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>ÃœrÃ¼n AdÄ± *</label>
                                    <input type="text" id="urunAd" placeholder="ÃœrÃ¼n adÄ±" required>
                                </div>
                                <div class="form-group">
                                    <label>Kategori</label>
                                    <select id="urunKategori">
                                        <option value="GÄ±da">GÄ±da</option>
                                        <option value="Ä°Ã§ecek">Ä°Ã§ecek</option>
                                        <option value="Temizlik">Temizlik</option>
                                        <option value="KÄ±rtasiye">KÄ±rtasiye</option>
                                        <option value="DiÄŸer">DiÄŸer</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>AlÄ±ÅŸ FiyatÄ± (â‚º)</label>
                                    <input type="number" id="urunAlis" step="0.01" placeholder="0.00">
                                </div>
                                <div class="form-group">
                                    <label>SatÄ±ÅŸ FiyatÄ± (â‚º) *</label>
                                    <input type="number" id="urunSatis" step="0.01" placeholder="0.00" required>
                                </div>
                                <div class="form-group">
                                    <label>Stok MiktarÄ±</label>
                                    <input type="number" id="urunStok" value="0">
                                </div>
                                <div class="form-group">
                                    <label>Kritik Stok Seviyesi</label>
                                    <input type="number" id="urunKritikStok" value="10">
                                </div>
                                <div class="form-group">
                                    <label>Birim</label>
                                    <select id="urunBirim">
                                        <option value="Adet">Adet</option>
                                        <option value="Kg">Kg</option>
                                        <option value="Litre">Litre</option>
                                        <option value="Paket">Paket</option>
                                    </select>
                                </div>
                            </div>
                            <div class="btn-group">
                                <button class="btn btn-success" onclick="urunKaydet()">ğŸ’¾ Kaydet</button>
                                <button class="btn btn-secondary" onclick="stokFormuGizle()">âŒ Ä°ptal</button>
                            </div>
                        </div>

                        <div class="search-box">
                            <input type="text" id="stokArama" placeholder="ÃœrÃ¼n ara..." onkeyup="stokAra()">
                        </div>

                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Barkod</th>
                                        <th>ÃœrÃ¼n AdÄ±</th>
                                        <th>Kategori</th>
                                        <th>Stok</th>
                                        <th>AlÄ±ÅŸ</th>
                                        <th>SatÄ±ÅŸ</th>
                                        <th>Ä°ÅŸlemler</th>
                                    </tr>
                                </thead>
                                <tbody id="stokTablosu"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- MÃ¼ÅŸteri YÃ¶netimi Tab -->
                <div id="musteriYonetim" class="tab-content">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Toplam MÃ¼ÅŸteri</div>
                            <div class="stat-value" id="toplamMusteri">0</div>
                        </div>
                        <div class="stat-card danger">
                            <div class="stat-label">Toplam BorÃ§</div>
                            <div class="stat-value" id="toplamBorc">0â‚º</div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span>ğŸ‘¥ MÃ¼ÅŸteri Listesi</span>
                            <button class="btn btn-primary" onclick="musteriFormuGoster()">â• Yeni MÃ¼ÅŸteri</button>
                        </div>

                        <div id="musteriFormu" class="hidden">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>Ad Soyad *</label>
                                    <input type="text" id="musteriAd" placeholder="Ad Soyad" required>
                                </div>
                                <div class="form-group">
                                    <label>Telefon</label>
                                    <input type="tel" id="musteriTelefon" placeholder="0555 555 55 55">
                                </div>
                                <div class="form-group">
                                    <label>E-posta</label>
                                    <input type="email" id="musteriEmail" placeholder="email@example.com">
                                </div>
                                <div class="form-group">
                                    <label>Adres</label>
                                    <textarea id="musteriAdres" rows="3" placeholder="Adres"></textarea>
                                </div>
                            </div>
                            <div class="btn-group">
                                <button class="btn btn-success" onclick="musteriKaydet()">ğŸ’¾ Kaydet</button>
                                <button class="btn btn-secondary" onclick="musteriFormuGizle()">âŒ Ä°ptal</button>
                            </div>
                        </div>

                        <div class="search-box">
                            <input type="text" id="musteriArama" placeholder="MÃ¼ÅŸteri ara..." onkeyup="musteriAra()">
                        </div>

                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Ad Soyad</th>
                                        <th>Telefon</th>
                                        <th>E-posta</th>
                                        <th>BorÃ§</th>
                                        <th>Ä°ÅŸlemler</th>
                                    </tr>
                                </thead>
                                <tbody id="musteriTablosu"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Personel YÃ¶netimi Tab -->
                <div id="personelYonetim" class="tab-content">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Toplam Personel</div>
                            <div class="stat-value" id="toplamPersonel">0</div>
                        </div>
                        <div class="stat-card success">
                            <div class="stat-label">Aktif Personel</div>
                            <div class="stat-value" id="aktifPersonel">0</div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span>ğŸ‘” Personel Listesi</span>
                            <button class="btn btn-primary" onclick="personelFormuGoster()">â• Yeni Personel</button>
                        </div>

                        <div id="personelFormu" class="hidden">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>Ad Soyad *</label>
                                    <input type="text" id="personelAd" placeholder="Ad Soyad" required>
                                </div>
                                <div class="form-group">
                                    <label>Telefon</label>
                                    <input type="tel" id="personelTelefon" placeholder="0555 555 55 55">
                                </div>
                                <div class="form-group">
                                    <label>GÃ¶rev</label>
                                    <select id="personelGorev">
                                        <option value="Kasiyer">Kasiyer</option>
                                        <option value="Depo Sorumlusu">Depo Sorumlusu</option>
                                        <option value="MÃ¼dÃ¼r">MÃ¼dÃ¼r</option>
                                        <option value="SatÄ±ÅŸ DanÄ±ÅŸmanÄ±">SatÄ±ÅŸ DanÄ±ÅŸmanÄ±</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>MaaÅŸ (â‚º)</label>
                                    <input type="number" id="personelMaas" step="0.01" placeholder="0.00">
                                </div>
                                <div class="form-group">
                                    <label>Ä°ÅŸe BaÅŸlama Tarihi</label>
                                    <input type="date" id="personelBaslangic">
                                </div>
                                <div class="form-group">
                                    <label>Durum</label>
                                    <select id="personelDurum">
                                        <option value="Aktif">Aktif</option>
                                        <option value="Ä°zinli">Ä°zinli</option>
                                        <option value="Pasif">Pasif</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>KullanÄ±cÄ± AdÄ±</label>
                                    <input type="text" id="personelKullanici" placeholder="KullanÄ±cÄ± adÄ±">
                                </div>
                                <div class="form-group">
                                    <label>Åifre</label>
                                    <input type="text" id="personelSifre" placeholder="Åifre" autocomplete="new-password">
                                </div>
                            </div>
                            <div class="btn-group">
                                <button type="button" class="btn btn-success" onclick="personelKaydet()">ğŸ’¾ Kaydet</button>
                                <button type="button" class="btn btn-secondary" onclick="personelFormuGizle()">âŒ Ä°ptal</button>
                            </div>
                        </div>

                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Ad Soyad</th>
                                        <th>Telefon</th>
                                        <th>GÃ¶rev</th>
                                        <th>MaaÅŸ</th>
                                        <th>Durum</th>
                                        <th>Ä°ÅŸlemler</th>
                                    </tr>
                                </thead>
                                <tbody id="personelTablosu"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- GÃ¼n Sonu Tab -->
                <div id="gunSonu" class="tab-content">
                    <div class="stats-grid">
                        <div class="stat-card success">
                            <div class="stat-label">Nakit</div>
                            <div class="stat-value"><span id="gunSonuNakit">0</span>â‚º</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Kredi KartÄ±</div>
                            <div class="stat-value"><span id="gunSonuKredi">0</span>â‚º</div>
                        </div>
                        <div class="stat-card warning">
                            <div class="stat-label">Veresiye</div>
                            <div class="stat-value"><span id="gunSonuVeresiye">0</span>â‚º</div>
                        </div>
                        <div class="stat-card success">
                            <div class="stat-label">Toplam SatÄ±ÅŸ</div>
                            <div class="stat-value"><span id="gunSonuToplam">0</span>â‚º</div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <span>ğŸ BugÃ¼nÃ¼n SatÄ±ÅŸlarÄ±</span>
                            <button class="btn btn-warning" onclick="gunSonuKapat()">ğŸ”’ GÃ¼n Sonu Kapat</button>
                        </div>

                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Saat</th>
                                        <th>MÃ¼ÅŸteri</th>
                                        <th>Tutar</th>
                                        <th>Ã–deme Tipi</th>
                                        <th>Personel</th>
                                    </tr>
                                </thead>
                                <tbody id="gunSonuTablosu"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Raporlar Tab -->
                <div id="raporlar" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <span>ğŸ“ˆ Raporlar ve Analizler</span>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label>Rapor Tipi</label>
                                <select id="raporTipi">
                                    <option value="gunluk">GÃ¼nlÃ¼k SatÄ±ÅŸ</option>
                                    <option value="haftalik">HaftalÄ±k SatÄ±ÅŸ</option>
                                    <option value="aylik">AylÄ±k SatÄ±ÅŸ</option>
                                    <option value="stok">Stok Durumu</option>
                                    <option value="musteri">MÃ¼ÅŸteri BorÃ§larÄ±</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>BaÅŸlangÄ±Ã§ Tarihi</label>
                                <input type="date" id="raporBaslangic">
                            </div>
                            <div class="form-group">
                                <label>BitiÅŸ Tarihi</label>
                                <input type="date" id="raporBitis">
                            </div>
                        </div>

                        <div class="btn-group">
                            <button class="btn btn-primary" onclick="raporOlustur()">ğŸ“Š Rapor OluÅŸtur</button>
                            <button class="btn btn-success" onclick="excelIndirRapor()">ğŸ“¥ Excel Ä°ndir</button>
                        </div>

                        <div id="raporSonuc" class="table-container"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header" id="modalBaslik"></div>
            <div id="modalIcerik"></div>
            <div class="modal-footer" id="modalFooter">
                <button class="btn btn-secondary" onclick="modalKapat()">Kapat</button>
            </div>
        </div>
    </div>

    <!-- Barkod Okuyucu -->
    <div id="scannerOverlay" class="scanner-overlay">
        <div class="scanner-container">
            <div class="scanner-header">
                ğŸ“· Barkod Okuyucu
            </div>
            <div id="scanner-viewport">
                <div class="scanner-line"></div>
            </div>
            <div class="scanner-footer">
                <button class="btn btn-danger" onclick="barkodOkuyucuKapat()">âŒ Kapat</button>
            </div>
        </div>
    </div>

    <script>
        // =============================================
        // EXCEL DATABASE SÄ°STEMÄ° (Evrensel - Her TarayÄ±cÄ±)
        // =============================================

        const DB = {
            urunler: [],
            musteriler: [],
            personeller: [
                {id: 1, ad: 'Admin', kullanici: 'admin', sifre: '1234', gorev: 'YÃ¶netici', durum: 'Aktif', maas: 0, telefon: '', baslangic: ''}
            ],
            satislar: [],
            sepet: [],
            currentUser: null
        };

        let kayitTimer = null;

        window.onload = function() {
            const u = localStorage.getItem('pos_urunler');
            const m = localStorage.getItem('pos_musteriler');
            const p = localStorage.getItem('pos_personeller');
            const s = localStorage.getItem('pos_satislar');
            if (u) try { DB.urunler = JSON.parse(u); } catch(e){}
            if (m) try { DB.musteriler = JSON.parse(m); } catch(e){}
            if (p) try { DB.personeller = JSON.parse(p); } catch(e){}
            if (s) try { DB.satislar = JSON.parse(s); } catch(e){}

            // Gizli file input oluÅŸtur
            const inp = document.createElement('input');
            inp.type = 'file';
            inp.id = 'dbFileInput';
            inp.accept = '.xlsx,.xls';
            inp.style.display = 'none';
            inp.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = function(ev) {
                    try {
                        const wb = XLSX.read(new Uint8Array(ev.target.result), { type: 'array' });
                        let yuklenen = {urun:0, musteri:0, personel:0, satis:0};
                        if (wb.SheetNames.includes('Urunler')) {
                            const data = XLSX.utils.sheet_to_json(wb.Sheets['Urunler']);
                            DB.urunler = data; yuklenen.urun = data.length;
                        }
                        if (wb.SheetNames.includes('Musteriler')) {
                            const data = XLSX.utils.sheet_to_json(wb.Sheets['Musteriler']);
                            DB.musteriler = data; yuklenen.musteri = data.length;
                        }
                        if (wb.SheetNames.includes('Personeller')) {
                            const data = XLSX.utils.sheet_to_json(wb.Sheets['Personeller']);
                            const adminVar = data.find(p => p.kullanici === 'admin');
                            if (!adminVar) data.unshift({id: 1, ad: 'Admin', kullanici: 'admin', sifre: '1234', gorev: 'YÃ¶netici', durum: 'Aktif', maas: 0, telefon: '', baslangic: ''});
                            DB.personeller = data; yuklenen.personel = data.length;
                        }
                        if (wb.SheetNames.includes('Satislar')) {
                            const data = XLSX.utils.sheet_to_json(wb.Sheets['Satislar']);
                            data.forEach(s => {
                                if (typeof s.urunler === 'string') {
                                    try { s.urunler = JSON.parse(s.urunler); } catch(e) { s.urunler = []; }
                                }
                            });
                            DB.satislar = data; yuklenen.satis = data.length;
                        }
                        if (yuklenen.urun === 0 && yuklenen.musteri === 0 && yuklenen.personel === 0) {
                            alert('âŒ Bu dosya POS veritabanÄ± formatÄ±nda deÄŸil!\nDoÄŸru sheet isimleri: Urunler, Musteriler, Personeller, Satislar');
                            return;
                        }
                        localStorage.setItem('pos_urunler', JSON.stringify(DB.urunler));
                        localStorage.setItem('pos_musteriler', JSON.stringify(DB.musteriler));
                        localStorage.setItem('pos_personeller', JSON.stringify(DB.personeller));
                        localStorage.setItem('pos_satislar', JSON.stringify(DB.satislar));
                        durumGuncelle('âœ… YÃ¼klendi: ' + file.name);
                        if (DB.currentUser) {
                            loadAllData();
                        }
                        alert('âœ… VeritabanÄ± yÃ¼klendi!\n\nğŸ“¦ ÃœrÃ¼n: ' + yuklenen.urun + '\nğŸ‘¥ MÃ¼ÅŸteri: ' + yuklenen.musteri + '\nğŸ‘” Personel: ' + yuklenen.personel + '\nğŸ›’ SatÄ±ÅŸ: ' + yuklenen.satis);
                        inp.value = '';
                    } catch(err) {
                        alert('âŒ Dosya okunamadÄ±: ' + err.message);
                    }
                };
                reader.readAsArrayBuffer(file);
            };
            document.body.appendChild(inp);
            initApp();
            durumGuncelle('ğŸ’¾ HazÄ±r â€” deÄŸiÅŸiklikler otomatik indirilir');
        };

        function excelDosyaAc() {
            document.getElementById('dbFileInput').click();
        }

        function saveToStorage() {
            // Sadece localStorage'a kaydet â€” Excel iÃ§in ğŸ’¾ Kaydet butonunu kullan
            localStorage.setItem('pos_urunler', JSON.stringify(DB.urunler));
            localStorage.setItem('pos_musteriler', JSON.stringify(DB.musteriler));
            localStorage.setItem('pos_personeller', JSON.stringify(DB.personeller));
            localStorage.setItem('pos_satislar', JSON.stringify(DB.satislar));
            // KaydedilmemiÅŸ deÄŸiÅŸiklik var iÅŸareti
            const el = document.getElementById('kayitDurum');
            if (el) { el.textContent = 'â— KaydedilmemiÅŸ deÄŸiÅŸiklik'; el.style.color = '#f59e0b'; }
        }

        async function excelKaydet() {
            try {
                const wb = XLSX.utils.book_new();

                const urunSheet = DB.urunler.length > 0
                    ? XLSX.utils.json_to_sheet(DB.urunler.map(u => ({id: u.id, barkod: u.barkod||'', ad: u.ad, kategori: u.kategori||'', alisFiyat: u.alisFiyat||0, satisFiyat: u.satisFiyat||0, stok: u.stok||0, kritikStok: u.kritikStok||10, birim: u.birim||'Adet'})))
                    : XLSX.utils.aoa_to_sheet([['id','barkod','ad','kategori','alisFiyat','satisFiyat','stok','kritikStok','birim']]);
                XLSX.utils.book_append_sheet(wb, urunSheet, 'Urunler');

                const musteriSheet = DB.musteriler.length > 0
                    ? XLSX.utils.json_to_sheet(DB.musteriler.map(m => ({id: m.id, ad: m.ad, telefon: m.telefon||'', email: m.email||'', adres: m.adres||'', borc: m.borc||0})))
                    : XLSX.utils.aoa_to_sheet([['id','ad','telefon','email','adres','borc']]);
                XLSX.utils.book_append_sheet(wb, musteriSheet, 'Musteriler');

                XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(
                    DB.personeller.map(p => ({id: p.id, ad: p.ad, telefon: p.telefon||'', gorev: p.gorev||'', maas: p.maas||0, baslangic: p.baslangic||'', durum: p.durum||'Aktif', kullanici: p.kullanici||'', sifre: p.sifre||''}))
                ), 'Personeller');

                const satisSheet = DB.satislar.length > 0
                    ? XLSX.utils.json_to_sheet(DB.satislar.map(s => ({id: s.id, fisNo: s.fisNo||'', tarih: s.tarih||'', musteriId: s.musteriId||'', toplam: s.toplam||0, odemeTipi: s.odemeTipi||'', personel: s.personel||'', urunler: JSON.stringify(s.urunler||[])})))
                    : XLSX.utils.aoa_to_sheet([['id','fisNo','tarih','musteriId','toplam','odemeTipi','personel','urunler']]);
                XLSX.utils.book_append_sheet(wb, satisSheet, 'Satislar');

                // Base64 olarak yaz - her tarayÄ±cÄ±da, her protokolde Ã§alÄ±ÅŸÄ±r
                const wbout = XLSX.write(wb, { bookType: 'xlsx', type: 'base64' });
                const dataURI = 'data:application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;base64,' + wbout;

                const a = document.createElement('a');
                a.href = dataURI;
                a.download = 'ERUH_POS_Veritabani.xlsx';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);

                const el = document.getElementById('kayitDurum');
                if (el) {
                    el.textContent = 'âœ… Kaydedildi ' + new Date().toLocaleTimeString('tr-TR', {hour:'2-digit', minute:'2-digit', second:'2-digit'});
                    el.style.color = '#10b981';
                }

            } catch(err) {
                console.error('Excel kayÄ±t hatasÄ±:', err);
                alert('âŒ KayÄ±t hatasÄ±: ' + err.message);
            }
        }

        let _sonKaydedilen = null;

        function kayitDurumGoster() {
            const el = document.getElementById('kayitDurum');
            if (!el) return;
            el.textContent = 'ğŸ’¾ ' + new Date().toLocaleTimeString('tr-TR', {hour:'2-digit', minute:'2-digit', second:'2-digit'});
            el.style.color = '#10b981';
            setTimeout(() => { if (el) el.textContent = ''; }, 3000);
        }

        function durumGuncelle(mesaj) {
            const el = document.getElementById('dbDurum');
            if (el) el.textContent = mesaj;
        }


        function initApp() {
            // BugÃ¼nÃ¼n tarihini ayarla
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('raporBaslangic').value = today;
            document.getElementById('raporBitis').value = today;
            document.getElementById('personelBaslangic').value = today;
        }

        // Login Ä°ÅŸlemleri
        function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            if (!username || !password) {
                alert('LÃ¼tfen kullanÄ±cÄ± adÄ± ve ÅŸifre giriniz!');
                return;
            }

            const user = DB.personeller.find(p => 
                p.kullanici === username && p.sifre === password && p.durum === 'Aktif'
            );

            if (user) {
                DB.currentUser = user;
                document.getElementById('currentUser').textContent = user.ad;
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('appContainer').style.display = 'flex';
                
                // TÃ¼m verileri yÃ¼kle
                loadAllData();
                alert('HoÅŸ geldiniz, ' + user.ad + '!');
            } else {
                alert('KullanÄ±cÄ± adÄ± veya ÅŸifre hatalÄ±!');
            }
        }

        function logout() {
            if (confirm('Ã‡Ä±kÄ±ÅŸ yapmak istediÄŸinize emin misiniz?')) {
                DB.currentUser = null;
                DB.sepet = [];
                document.getElementById('loginScreen').style.display = 'block';
                document.getElementById('appContainer').style.display = 'none';
                document.getElementById('loginUsername').value = '';
                document.getElementById('loginPassword').value = '';
            }
        }

        // Tab DeÄŸiÅŸtirme
        function switchTab(tabName, clickedEl) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.dash-nav-card, .nav-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            if (clickedEl) clickedEl.classList.add('active');
            loadTabData(tabName);
        }

        function loadTabData(tabName) {
            switch(tabName) {
                case 'hizliKasa':
                    loadKasaMusteriSelect();
                    break;
                case 'stokYonetim':
                    loadStokTablosu();
                    updateStokStats();
                    break;
                case 'musteriYonetim':
                    loadMusteriTablosu();
                    updateMusteriStats();
                    break;
                case 'personelYonetim':
                    loadPersonelTablosu();
                    updatePersonelStats();
                    break;
                case 'gunSonu':
                    loadGunSonu();
                    break;
            }
        }

        function loadAllData() {
            loadStokTablosu();
            loadMusteriTablosu();
            loadPersonelTablosu();
            loadKasaMusteriSelect();
            updateStokStats();
            updateMusteriStats();
            updatePersonelStats();
        }

        // KASA Ä°ÅLEMLERÄ°
        document.getElementById('barkodInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const value = this.value.trim();
                if (value) {
                    urunBul(value);
                    this.value = '';
                }
            }
        });

        // ÃœrÃ¼n ara - autocomplete
        document.getElementById('barkodInput').addEventListener('input', function(e) {
            const aramaKelimesi = this.value.trim().toLowerCase();
            
            if (aramaKelimesi.length >= 2) {
                const eslesen = DB.urunler.filter(u => 
                    u.ad.toLowerCase().includes(aramaKelimesi) ||
                    (u.barkod && u.barkod.toLowerCase().includes(aramaKelimesi))
                ).slice(0, 5);

                if (eslesen.length > 0) {
                    let liste = '<div style="position:absolute; background:white; border:2px solid var(--border); border-radius:8px; margin-top:5px; box-shadow:0 4px 10px rgba(0,0,0,0.1); z-index:100; max-width:500px;">';
                    eslesen.forEach(urun => {
                        liste += `
                            <div onclick="urunSec(${urun.id})" style="padding:12px; cursor:pointer; border-bottom:1px solid var(--border); transition: all 0.2s;" 
                                 onmouseover="this.style.background='var(--light)'" 
                                 onmouseout="this.style.background='white'">
                                <div style="font-weight:600; color:var(--dark);">${urun.ad}</div>
                                <div style="font-size:13px; color:#6b7280; margin-top:4px;">
                                    ${urun.barkod || 'Barkod Yok'} | Stok: ${urun.stok} ${urun.birim} | ${(urun.satisFiyat || 0).toFixed(2)} â‚º
                                </div>
                            </div>
                        `;
                    });
                    liste += '</div>';
                    
                    // Ã–nce eski Ã¶neri listesini kaldÄ±r
                    const eskiListe = document.getElementById('oneriListesi');
                    if (eskiListe) eskiListe.remove();
                    
                    // Yeni listeyi ekle
                    const oneriDiv = document.createElement('div');
                    oneriDiv.id = 'oneriListesi';
                    oneriDiv.innerHTML = liste;
                    this.parentElement.style.position = 'relative';
                    this.parentElement.appendChild(oneriDiv);
                }
            } else {
                // Ã–neri listesini kaldÄ±r
                const eskiListe = document.getElementById('oneriListesi');
                if (eskiListe) eskiListe.remove();
            }
        });

        // Ã–neri listesi dÄ±ÅŸÄ±na tÄ±klanÄ±nca kapat
        document.addEventListener('click', function(e) {
            if (!e.target.closest('#barkodInput')) {
                const eskiListe = document.getElementById('oneriListesi');
                if (eskiListe) eskiListe.remove();
            }
        });

        function urunSec(urunId) {
            const urun = DB.urunler.find(u => u.id === urunId);
            if (urun) {
                sepeteEkle(urun);
                document.getElementById('barkodInput').value = '';
                const eskiListe = document.getElementById('oneriListesi');
                if (eskiListe) eskiListe.remove();
            }
        }

        function urunBul(aramaKelimesi) {
            // Ã–nce tam barkod eÅŸleÅŸmesi ara
            let urun = DB.urunler.find(u => u.barkod && u.barkod === aramaKelimesi);
            
            // Bulamazsa barkod iÃ§inde ara
            if (!urun) {
                urun = DB.urunler.find(u => u.barkod && u.barkod.includes(aramaKelimesi));
            }
            
            // Hala bulamazsa Ã¼rÃ¼n adÄ±nda ara (tam eÅŸleÅŸme)
            if (!urun) {
                urun = DB.urunler.find(u => 
                    u.ad.toLowerCase() === aramaKelimesi.toLowerCase()
                );
            }
            
            // Hala bulamazsa Ã¼rÃ¼n adÄ±nda kÄ±smi eÅŸleÅŸme ara
            if (!urun) {
                urun = DB.urunler.find(u => 
                    u.ad.toLowerCase().includes(aramaKelimesi.toLowerCase())
                );
            }

            if (urun) {
                sepeteEkle(urun);
            } else {
                alert('âŒ ÃœrÃ¼n bulunamadÄ±! AradÄ±ÄŸÄ±nÄ±z: "' + aramaKelimesi + '"');
            }
        }

        function sepeteEkle(urun) {
            const mevcutItem = DB.sepet.find(item => item.id === urun.id);
            
            if (mevcutItem) {
                if (mevcutItem.adet < urun.stok) {
                    mevcutItem.adet++;
                } else {
                    alert('Stokta yeterli Ã¼rÃ¼n yok!');
                    return;
                }
            } else {
                if (urun.stok > 0) {
                    DB.sepet.push({
                        id: urun.id,
                        ad: urun.ad,
                        fiyat: urun.satisFiyat,
                        alisFiyat: urun.alisFiyat || 0,
                        adet: 1,
                        stok: urun.stok
                    });
                } else {
                    alert('Bu Ã¼rÃ¼n stokta yok!');
                    return;
                }
            }

            sepetGuncelle();
        }

        function sepetGuncelle() {
            const sepetListesi = document.getElementById('sepetListesi');
            sepetListesi.innerHTML = '';

            let toplam = 0;

            DB.sepet.forEach((item, index) => {
                const itemToplam = item.fiyat * item.adet;
                toplam += itemToplam;

                const alisFiyat = item.alisFiyat || 0;
                const karMarji = ((item.fiyat - alisFiyat) / item.fiyat * 100).toFixed(1);

                sepetListesi.innerHTML += `
                    <div class="cart-item">
                        <div class="cart-item-info">
                            <div class="cart-item-name">${item.ad}</div>
                            <div class="cart-item-price">
                                AlÄ±ÅŸ: ${alisFiyat.toFixed(2)} â‚º | SatÄ±ÅŸ: ${item.fiyat.toFixed(2)} â‚º | Kar: %${karMarji}
                            </div>
                            <div class="cart-item-price" style="color: var(--primary); font-weight: 600;">
                                ${item.fiyat.toFixed(2)} â‚º x ${item.adet} = ${itemToplam.toFixed(2)} â‚º
                            </div>
                        </div>
                        <div class="cart-item-controls">
                            <button class="qty-btn" onclick="adetDegistir(${index}, -1)">-</button>
                            <span style="font-weight:700; min-width:30px; text-align:center;">${item.adet}</span>
                            <button class="qty-btn" onclick="adetDegistir(${index}, 1)">+</button>
                            <button class="btn btn-danger" style="padding:8px 12px; margin-left:10px;" onclick="sepettenCikar(${index})">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                `;
            });

            document.getElementById('sepetToplam').textContent = toplam.toFixed(2);
        }

        function adetDegistir(index, degisim) {
            const item = DB.sepet[index];
            const yeniAdet = item.adet + degisim;

            if (yeniAdet <= 0) {
                sepettenCikar(index);
                return;
            }

            if (yeniAdet > item.stok) {
                alert('Stokta yeterli Ã¼rÃ¼n yok!');
                return;
            }

            item.adet = yeniAdet;
            sepetGuncelle();
        }

        function sepettenCikar(index) {
            DB.sepet.splice(index, 1);
            sepetGuncelle();
        }

        function sepetTemizle() {
            if (DB.sepet.length === 0) {
                alert('Sepet zaten boÅŸ!');
                return;
            }

            if (confirm('Sepeti temizlemek istediÄŸinize emin misiniz?')) {
                DB.sepet = [];
                sepetGuncelle();
            }
        }

        function odemeTamamla(tip) {
            if (DB.sepet.length === 0) {
                alert('Sepet boÅŸ!');
                return;
            }

            const musteriId = document.getElementById('kasaMusteriSelect').value;
            const toplam = parseFloat(document.getElementById('sepetToplam').textContent);

            // SatÄ±ÅŸ kaydÄ± oluÅŸtur
            const satis = {
                id: Date.now(),
                tarih: new Date().toISOString(),
                musteriId: musteriId || null,
                urunler: [...DB.sepet],
                toplam: toplam,
                odemeTipi: tip,
                personel: DB.currentUser.ad,
                fisNo: 'FIS' + Date.now().toString().slice(-8)
            };

            // StoklarÄ± gÃ¼ncelle
            DB.sepet.forEach(item => {
                const urun = DB.urunler.find(u => u.id === item.id);
                if (urun) {
                    urun.stok -= item.adet;
                }
            });

            // Veresiye ise mÃ¼ÅŸteri borcunu gÃ¼ncelle
            if (tip === 'veresiye' && musteriId) {
                const musteri = DB.musteriler.find(m => m.id === parseInt(musteriId));
                if (musteri) {
                    musteri.borc = (musteri.borc || 0) + toplam;
                }
            }

            // SatÄ±ÅŸÄ± kaydet
            DB.satislar.push(satis);

            // LocalStorage'a kaydet
            saveToStorage();

            // FiÅŸ gÃ¶ster
            fisGoster(satis);

            // Sepeti temizle
            DB.sepet = [];
            sepetGuncelle();
            loadStokTablosu();
        }

        function fisGoster(satis) {
            const musteri = satis.musteriId ? 
                DB.musteriler.find(m => m.id === parseInt(satis.musteriId)) : null;
            
            const tarihObj = new Date(satis.tarih);
            const tarih = tarihObj.toLocaleDateString('tr-TR');
            const saat = tarihObj.toLocaleTimeString('tr-TR', {hour: '2-digit', minute: '2-digit'});

            let odemeTipiText = '';
            if (satis.odemeTipi === 'nakit') odemeTipiText = 'ğŸ’µ NAKÄ°T';
            else if (satis.odemeTipi === 'kredi') odemeTipiText = 'ğŸ’³ KREDÄ° KARTI';
            else if (satis.odemeTipi === 'veresiye') odemeTipiText = 'ğŸ“‹ VERESÄ°YE';

            let urunlerHTML = '';
            let toplamKar = 0;

            satis.urunler.forEach(item => {
                const itemToplam = item.fiyat * item.adet;
                const itemKar = (item.fiyat - (item.alisFiyat || 0)) * item.adet;
                toplamKar += itemKar;

                urunlerHTML += `
                    <div class="fis-urun">
                        <div class="fis-urun-ad">${item.ad}</div>
                        <div style="text-align: center;">${item.adet} x ${item.fiyat.toFixed(2)}</div>
                        <div style="text-align: right; font-weight: bold;">${itemToplam.toFixed(2)} â‚º</div>
                    </div>
                `;
            });

            const fisHTML = `
                <div class="fis-container" id="fisIcerik">
                    <div class="fis-header">
                        <div class="fis-logo">â­ ERUH KOMANDO â­</div>
                        <div class="fis-bilgi">
                            BÄ°RLÄ°K POS SÄ°STEMÄ°<br>
                            Tel: 0555 555 55 55<br>
                            Adres: Eruh / Siirt
                        </div>
                    </div>

                    <div class="fis-tarih">
                        <div>ğŸ“… ${tarih}</div>
                        <div>ğŸ• ${saat}</div>
                        <div>ğŸ“„ ${satis.fisNo}</div>
                    </div>

                    ${musteri ? `
                        <div style="padding: 10px 0; border-bottom: 1px dashed #666; margin-bottom: 10px; font-size: 12px;">
                            <strong>ğŸ‘¤ MÃ¼ÅŸteri:</strong> ${musteri.ad}<br>
                            ${musteri.telefon ? `<strong>ğŸ“ Tel:</strong> ${musteri.telefon}` : ''}
                        </div>
                    ` : ''}

                    <div class="fis-urunler">
                        <div class="fis-urun" style="font-weight: bold; border-bottom: 2px solid #333;">
                            <div>ÃœRÃœN</div>
                            <div style="text-align: center;">ADET x FÄ°YAT</div>
                            <div style="text-align: right;">TOPLAM</div>
                        </div>
                        ${urunlerHTML}
                    </div>

                    <div class="fis-toplam">
                        <div class="fis-toplam-satir">
                            <span>Ara Toplam:</span>
                            <span>${satis.toplam.toFixed(2)} â‚º</span>
                        </div>
                        <div class="fis-toplam-satir">
                            <span>KDV (%20):</span>
                            <span>${(satis.toplam * 0.20).toFixed(2)} â‚º</span>
                        </div>
                        <div class="fis-toplam-satir grand">
                            <span>GENEL TOPLAM:</span>
                            <span>${satis.toplam.toFixed(2)} â‚º</span>
                        </div>
                        <div class="fis-toplam-satir" style="margin-top: 10px; font-size: 14px; font-weight: bold;">
                            <span>Ã–deme Tipi:</span>
                            <span>${odemeTipiText}</span>
                        </div>
                        ${toplamKar > 0 ? `
                            <div class="fis-toplam-satir" style="color: green; margin-top: 5px;">
                                <span>Kar:</span>
                                <span>${toplamKar.toFixed(2)} â‚º</span>
                            </div>
                        ` : ''}
                    </div>

                    <div class="fis-footer">
                        <div class="fis-tesekkur">ğŸ™ TEÅEKKÃœR EDERÄ°Z ğŸ™</div>
                        <div>Kassiyer: ${satis.personel}</div>
                        <div style="margin-top: 10px; font-size: 10px;">
                            Bu fiÅŸ resmi fatura yerine geÃ§mez.<br>
                            14 gÃ¼n iÃ§inde iade yapÄ±labilir.
                        </div>
                    </div>
                </div>
            `;

            const modalIcerik = `
                ${fisHTML}
                <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
                    <button class="btn btn-success" onclick="fisYazdir()">ğŸ–¨ï¸ YazdÄ±r</button>
                    <button class="btn btn-primary" onclick="whatsappGonder('${satis.fisNo}')">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" 
                             style="width: 20px; height: 20px; vertical-align: middle; margin-right: 5px;">
                        WhatsApp GÃ¶nder
                    </button>
                    <button class="btn btn-warning" onclick="fisPDFIndir('${satis.fisNo}')">ğŸ“„ PDF Ä°ndir</button>
                </div>
            `;

            modalAc('âœ… SatÄ±ÅŸ TamamlandÄ± - FiÅŸ', modalIcerik);
        }

        function fisYazdir() {
            window.print();
        }

        function whatsappGonder(fisNo) {
            const satis = DB.satislar.find(s => s.fisNo === fisNo);
            if (!satis) {
                alert('FiÅŸ bulunamadÄ±!');
                return;
            }

            const musteri = satis.musteriId ? 
                DB.musteriler.find(m => m.id === parseInt(satis.musteriId)) : null;

            // MÃ¼ÅŸteri telefon numarasÄ± kontrolÃ¼
            let telefon = '';
            if (musteri && musteri.telefon) {
                telefon = musteri.telefon.replace(/\D/g, ''); // Sadece rakamlar
                if (!telefon.startsWith('90')) {
                    telefon = '90' + telefon; // TÃ¼rkiye kodu ekle
                }
            } else {
                telefon = prompt('WhatsApp iÃ§in telefon numarasÄ± girin:\n(Ã–rnek: 905551234567)');
                if (!telefon) return;
                telefon = telefon.replace(/\D/g, '');
                if (!telefon.startsWith('90')) {
                    telefon = '90' + telefon;
                }
            }

            const tarihObj = new Date(satis.tarih);
            const tarih = tarihObj.toLocaleDateString('tr-TR');
            const saat = tarihObj.toLocaleTimeString('tr-TR', {hour: '2-digit', minute: '2-digit'});

            let mesaj = `*â­ ERUH KOMANDO - SATIÅ FÄ°ÅÄ° â­*\n\n`;
            mesaj += `ğŸ“„ FiÅŸ No: ${satis.fisNo}\n`;
            mesaj += `ğŸ“… Tarih: ${tarih} - ${saat}\n`;
            mesaj += `ğŸ‘¤ Kasiyer: ${satis.personel}\n`;
            
            if (musteri) {
                mesaj += `\n*MÃœÅTERÄ° BÄ°LGÄ°LERÄ°*\n`;
                mesaj += `Ad: ${musteri.ad}\n`;
            }

            mesaj += `\n*ÃœRÃœNLER*\n`;
            mesaj += `${'â”€'.repeat(35)}\n`;

            satis.urunler.forEach(item => {
                const itemToplam = item.fiyat * item.adet;
                mesaj += `${item.ad}\n`;
                mesaj += `  ${item.adet} x ${item.fiyat.toFixed(2)} â‚º = ${itemToplam.toFixed(2)} â‚º\n`;
            });

            mesaj += `${'â”€'.repeat(35)}\n`;
            mesaj += `\n*ARA TOPLAM:* ${satis.toplam.toFixed(2)} â‚º\n`;
            mesaj += `*KDV (%20):* ${(satis.toplam * 0.20).toFixed(2)} â‚º\n`;
            mesaj += `\n*ğŸ¯ GENEL TOPLAM: ${satis.toplam.toFixed(2)} â‚º*\n`;
            
            let odemeTipi = satis.odemeTipi === 'nakit' ? 'ğŸ’µ Nakit' : 
                           satis.odemeTipi === 'kredi' ? 'ğŸ’³ Kredi KartÄ±' : 'ğŸ“‹ Veresiye';
            mesaj += `\n*Ã–deme Åekli:* ${odemeTipi}\n`;

            mesaj += `\n${'â”€'.repeat(35)}\n`;
            mesaj += `ğŸ™ *TEÅEKKÃœR EDERÄ°Z* ğŸ™\n`;
            mesaj += `\nğŸ“ Ä°letiÅŸim: 0555 555 55 55\n`;
            mesaj += `ğŸ“ Adres: Eruh / Siirt`;

            const whatsappURL = `https://wa.me/${telefon}?text=${encodeURIComponent(mesaj)}`;
            window.open(whatsappURL, '_blank');
        }

        function fisPDFIndir(fisNo) {
            // Basit bir HTML to PDF yaklaÅŸÄ±mÄ± - yazdÄ±r dialog kullanarak
            alert('PDF indirme iÃ§in "YazdÄ±r" butonuna tÄ±klayÄ±n ve yazÄ±cÄ± olarak "PDF olarak kaydet" seÃ§in.');
            fisYazdir();
        }

        // STOK YÃ–NETÄ°MÄ°
        let editingUrunId = null;

        function stokFormuGoster() {
            document.getElementById('stokFormu').classList.remove('hidden');
            temizleStokFormu();
            editingUrunId = null;
        }

        function stokFormuGizle() {
            document.getElementById('stokFormu').classList.add('hidden');
            temizleStokFormu();
            editingUrunId = null;
        }

        function temizleStokFormu() {
            document.getElementById('urunBarkod').value = '';
            document.getElementById('urunAd').value = '';
            document.getElementById('urunKategori').value = 'GÄ±da';
            document.getElementById('urunAlis').value = '';
            document.getElementById('urunSatis').value = '';
            document.getElementById('urunStok').value = '0';
            document.getElementById('urunKritikStok').value = '10';
            document.getElementById('urunBirim').value = 'Adet';
        }

        function urunKaydet() {
            const ad = document.getElementById('urunAd').value.trim();
            const satisFiyat = parseFloat(document.getElementById('urunSatis').value);

            if (!ad || !satisFiyat) {
                alert('LÃ¼tfen Ã¼rÃ¼n adÄ± ve satÄ±ÅŸ fiyatÄ± giriniz!');
                return;
            }

            const urun = {
                id: editingUrunId || Date.now(),
                barkod: document.getElementById('urunBarkod').value.trim(),
                ad: ad,
                kategori: document.getElementById('urunKategori').value,
                alisFiyat: parseFloat(document.getElementById('urunAlis').value) || 0,
                satisFiyat: satisFiyat,
                stok: parseInt(document.getElementById('urunStok').value) || 0,
                kritikStok: parseInt(document.getElementById('urunKritikStok').value) || 10,
                birim: document.getElementById('urunBirim').value
            };

            if (editingUrunId) {
                const index = DB.urunler.findIndex(u => u.id === editingUrunId);
                DB.urunler[index] = urun;
            } else {
                DB.urunler.push(urun);
            }

            saveToStorage();
            loadStokTablosu();
            updateStokStats();
            stokFormuGizle();
            alert('ÃœrÃ¼n kaydedildi!');
        }

        function loadStokTablosu(aramaKelimesi = '') {
            const tbody = document.getElementById('stokTablosu');
            tbody.innerHTML = '';

            let urunler = DB.urunler;
            if (aramaKelimesi) {
                urunler = urunler.filter(u => 
                    u.ad.toLowerCase().includes(aramaKelimesi.toLowerCase()) ||
                    (u.barkod && u.barkod.toLowerCase().includes(aramaKelimesi.toLowerCase()))
                );
            }

            urunler.forEach(urun => {
                const kritik = urun.stok <= urun.kritikStok;
                const stokBadge = kritik ? 
                    `<span class="badge badge-danger">${urun.stok} ${urun.birim}</span>` : 
                    `<span class="badge badge-success">${urun.stok} ${urun.birim}</span>`;

                tbody.innerHTML += `
                    <tr>
                        <td>${urun.barkod || '-'}</td>
                        <td>${urun.ad}</td>
                        <td>${urun.kategori}</td>
                        <td>${stokBadge}</td>
                        <td>${(urun.alisFiyat || 0).toFixed(2)} â‚º</td>
                        <td>${(urun.satisFiyat || 0).toFixed(2)} â‚º</td>
                        <td>
                            <button class="btn btn-primary" style="padding:6px 12px; font-size:13px;" onclick="urunDuzenle(${urun.id})">âœï¸</button>
                            <button class="btn btn-danger" style="padding:6px 12px; font-size:13px;" onclick="urunSil(${urun.id})">ğŸ—‘ï¸</button>
                        </td>
                    </tr>
                `;
            });
        }

        function stokAra() {
            const aramaKelimesi = document.getElementById('stokArama').value;
            loadStokTablosu(aramaKelimesi);
        }

        function urunDuzenle(id) {
            const urun = DB.urunler.find(u => u.id === id);
            if (!urun) return;

            editingUrunId = id;
            // Ã–nce formu gÃ¶ster, sonra verileri doldur
            document.getElementById('stokFormu').classList.remove('hidden');
            document.getElementById('excelYuklemeAlani').classList.add('hidden');

            document.getElementById('urunBarkod').value = urun.barkod || '';
            document.getElementById('urunAd').value = urun.ad;
            document.getElementById('urunKategori').value = urun.kategori;
            document.getElementById('urunAlis').value = urun.alisFiyat;
            document.getElementById('urunSatis').value = urun.satisFiyat;
            document.getElementById('urunStok').value = urun.stok;
            document.getElementById('urunKritikStok').value = urun.kritikStok || 10;
            document.getElementById('urunBirim').value = urun.birim || 'Adet';
        }

        function urunSil(id) {
            if (confirm('Bu Ã¼rÃ¼nÃ¼ silmek istediÄŸinize emin misiniz?')) {
                DB.urunler = DB.urunler.filter(u => u.id !== id);
                saveToStorage();
                loadStokTablosu();
                updateStokStats();
                alert('ÃœrÃ¼n silindi!');
            }
        }

        function updateStokStats() {
            const toplamUrun = DB.urunler.length;
            const stokDegeri = DB.urunler.reduce((sum, u) => sum + ((u.stok || 0) * (u.alisFiyat || 0)), 0);
            const kritikStok = DB.urunler.filter(u => u.stok <= u.kritikStok).length;

            document.getElementById('toplamUrun').textContent = toplamUrun;
            document.getElementById('stokDegeri').textContent = stokDegeri.toFixed(0) + 'â‚º';
            document.getElementById('kritikStok').textContent = kritikStok;
        }

        // MÃœÅTERÄ° YÃ–NETÄ°MÄ°
        let editingMusteriId = null;

        function musteriFormuGoster() {
            document.getElementById('musteriFormu').classList.remove('hidden');
            temizleMusteriFormu();
            editingMusteriId = null;
        }

        function musteriFormuGizle() {
            document.getElementById('musteriFormu').classList.add('hidden');
            temizleMusteriFormu();
            editingMusteriId = null;
        }

        function temizleMusteriFormu() {
            document.getElementById('musteriAd').value = '';
            document.getElementById('musteriTelefon').value = '';
            document.getElementById('musteriEmail').value = '';
            document.getElementById('musteriAdres').value = '';
        }

        function musteriKaydet() {
            const ad = document.getElementById('musteriAd').value.trim();

            if (!ad) {
                alert('LÃ¼tfen mÃ¼ÅŸteri adÄ± giriniz!');
                return;
            }

            const musteri = {
                id: editingMusteriId || Date.now(),
                ad: ad,
                telefon: document.getElementById('musteriTelefon').value.trim(),
                email: document.getElementById('musteriEmail').value.trim(),
                adres: document.getElementById('musteriAdres').value.trim(),
                borc: 0
            };

            if (editingMusteriId) {
                const index = DB.musteriler.findIndex(m => m.id === editingMusteriId);
                const eskiBorc = DB.musteriler[index].borc;
                musteri.borc = eskiBorc;
                DB.musteriler[index] = musteri;
            } else {
                DB.musteriler.push(musteri);
            }

            saveToStorage();
            loadMusteriTablosu();
            loadKasaMusteriSelect();
            updateMusteriStats();
            musteriFormuGizle();
            alert('MÃ¼ÅŸteri kaydedildi!');
        }

        function loadMusteriTablosu(aramaKelimesi = '') {
            const tbody = document.getElementById('musteriTablosu');
            tbody.innerHTML = '';

            let musteriler = DB.musteriler;
            if (aramaKelimesi) {
                musteriler = musteriler.filter(m => 
                    m.ad.toLowerCase().includes(aramaKelimesi.toLowerCase()) ||
                    (m.telefon && m.telefon.includes(aramaKelimesi))
                );
            }

            musteriler.forEach(musteri => {
                const borcBadge = (musteri.borc || 0) > 0 ? 
                    `<span class="badge badge-danger">${(musteri.borc || 0).toFixed(2)} â‚º</span>` : 
                    `<span class="badge badge-success">0 â‚º</span>`;

                tbody.innerHTML += `
                    <tr>
                        <td>${musteri.ad}</td>
                        <td>${musteri.telefon || '-'}</td>
                        <td>${musteri.email || '-'}</td>
                        <td>${borcBadge}</td>
                        <td>
                            <button class="btn btn-primary" style="padding:6px 12px; font-size:13px;" onclick="musteriDuzenle(${musteri.id})">âœï¸</button>
                            <button class="btn btn-danger" style="padding:6px 12px; font-size:13px;" onclick="musteriSil(${musteri.id})">ğŸ—‘ï¸</button>
                            ${(musteri.borc || 0) > 0 ? `<button class="btn btn-success" style="padding:6px 12px; font-size:13px;" onclick="borcOde(${musteri.id})">ğŸ’°</button>` : ''}
                        </td>
                    </tr>
                `;
            });
        }

        function musteriAra() {
            const aramaKelimesi = document.getElementById('musteriArama').value;
            loadMusteriTablosu(aramaKelimesi);
        }

        function musteriDuzenle(id) {
            const musteri = DB.musteriler.find(m => m.id === id);
            if (!musteri) return;

            editingMusteriId = id;
            document.getElementById('musteriAd').value = musteri.ad;
            document.getElementById('musteriTelefon').value = musteri.telefon;
            document.getElementById('musteriEmail').value = musteri.email;
            document.getElementById('musteriAdres').value = musteri.adres;

            musteriFormuGoster();
        }

        function musteriSil(id) {
            const musteri = DB.musteriler.find(m => m.id === id);
            if (musteri && (musteri.borc || 0) > 0) {
                alert('Bu mÃ¼ÅŸterinin borcu var! Ã–nce borcu kapatÄ±nÄ±z.');
                return;
            }

            if (confirm('Bu mÃ¼ÅŸteriyi silmek istediÄŸinize emin misiniz?')) {
                DB.musteriler = DB.musteriler.filter(m => m.id !== id);
                saveToStorage();
                loadMusteriTablosu();
                loadKasaMusteriSelect();
                updateMusteriStats();
                alert('MÃ¼ÅŸteri silindi!');
            }
        }

        function borcOde(id) {
            const musteri = DB.musteriler.find(m => m.id === id);
            if (!musteri) return;

            const odenecek = prompt(`${musteri.ad} - BorÃ§: ${(musteri.borc || 0).toFixed(2)} â‚º\n\nÃ–denecek tutar:`);
            if (odenecek === null) return;

            const tutar = parseFloat(odenecek);
            if (isNaN(tutar) || tutar <= 0) {
                alert('GeÃ§erli bir tutar giriniz!');
                return;
            }

            if (tutar > (musteri.borc || 0)) {
                alert('Ã–deme tutarÄ± borÃ§tan fazla olamaz!');
                return;
            }

            musteri.borc -= tutar;
            saveToStorage();
            loadMusteriTablosu();
            updateMusteriStats();
            alert('Ã–deme alÄ±ndÄ±!');
        }

        function loadKasaMusteriSelect() {
            const select = document.getElementById('kasaMusteriSelect');
            select.innerHTML = '<option value="">MÃ¼ÅŸteri SeÃ§in (Opsiyonel)</option>';

            DB.musteriler.forEach(musteri => {
                select.innerHTML += `<option value="${musteri.id}">${musteri.ad}</option>`;
            });
        }

        function updateMusteriStats() {
            const toplamMusteri = DB.musteriler.length;
            const toplamBorc = DB.musteriler.reduce((sum, m) => sum + (m.borc || 0), 0);

            document.getElementById('toplamMusteri').textContent = toplamMusteri;
            document.getElementById('toplamBorc').textContent = toplamBorc.toFixed(0) + 'â‚º';
        }

        // PERSONEL YÃ–NETÄ°MÄ°
        let editingPersonelId = null;

        function personelFormuGoster() {
            document.getElementById('personelFormu').classList.remove('hidden');
            temizlePersonelFormu();
            editingPersonelId = null;
        }

        function personelFormuGizle() {
            document.getElementById('personelFormu').classList.add('hidden');
            temizlePersonelFormu();
            editingPersonelId = null;
        }

        function temizlePersonelFormu() {
            document.getElementById('personelAd').value = '';
            document.getElementById('personelTelefon').value = '';
            document.getElementById('personelGorev').value = 'Kasiyer';
            document.getElementById('personelMaas').value = '';
            document.getElementById('personelBaslangic').value = new Date().toISOString().split('T')[0];
            document.getElementById('personelDurum').value = 'Aktif';
            document.getElementById('personelKullanici').value = '';
            document.getElementById('personelSifre').value = '';
        }

        function personelKaydet() {
            const ad = document.getElementById('personelAd').value.trim();

            if (!ad) {
                alert('LÃ¼tfen personel adÄ± giriniz!');
                return;
            }

            const kullanici = document.getElementById('personelKullanici').value.trim();
            const sifre = document.getElementById('personelSifre').value.trim();

            // KullanÄ±cÄ± adÄ± varsa aynÄ± kullanÄ±cÄ± adÄ± kontrolÃ¼ yap
            if (kullanici) {
                const mevcutKullanici = DB.personeller.find(p => 
                    p.kullanici === kullanici && p.id !== editingPersonelId
                );
                if (mevcutKullanici) {
                    alert('Bu kullanÄ±cÄ± adÄ± zaten kullanÄ±lÄ±yor!');
                    return;
                }
            }

            const personel = {
                id: editingPersonelId || Date.now(),
                ad: ad,
                telefon: document.getElementById('personelTelefon').value.trim(),
                gorev: document.getElementById('personelGorev').value,
                maas: parseFloat(document.getElementById('personelMaas').value) || 0,
                baslangic: document.getElementById('personelBaslangic').value,
                durum: document.getElementById('personelDurum').value,
                kullanici: kullanici,
                sifre: sifre
            };

            if (editingPersonelId) {
                const index = DB.personeller.findIndex(p => p.id === editingPersonelId);
                if (index !== -1) {
                    DB.personeller[index] = personel;
                }
            } else {
                DB.personeller.push(personel);
            }

            editingPersonelId = null;
            saveToStorage();
            loadPersonelTablosu();
            updatePersonelStats();
            document.getElementById('personelFormu').classList.add('hidden');
            temizlePersonelFormu();
            alert('Personel kaydedildi!');
        }

        function loadPersonelTablosu() {
            const tbody = document.getElementById('personelTablosu');
            tbody.innerHTML = '';

            DB.personeller.forEach(personel => {
                let durumBadge = '';
                if (personel.durum === 'Aktif') {
                    durumBadge = '<span class="badge badge-success">Aktif</span>';
                } else if (personel.durum === 'Ä°zinli') {
                    durumBadge = '<span class="badge badge-warning">Ä°zinli</span>';
                } else {
                    durumBadge = '<span class="badge badge-danger">Pasif</span>';
                }

                tbody.innerHTML += `
                    <tr>
                        <td>${personel.ad}</td>
                        <td>${personel.telefon || '-'}</td>
                        <td>${personel.gorev}</td>
                        <td>${(personel.maas || 0).toFixed(2)} â‚º</td>
                        <td>${durumBadge}</td>
                        <td>
                            <button class="btn btn-primary" style="padding:6px 12px; font-size:13px;" onclick="personelDuzenle(${personel.id})">âœï¸</button>
                            ${personel.id !== 1 ? `<button class="btn btn-danger" style="padding:6px 12px; font-size:13px;" onclick="personelSil(${personel.id})">ğŸ—‘ï¸</button>` : ''}
                        </td>
                    </tr>
                `;
            });
        }

        function personelDuzenle(id) {
            const personel = DB.personeller.find(p => p.id === id);
            if (!personel) return;

            editingPersonelId = id;
            // Ã–nce formu gÃ¶ster, sonra verileri doldur
            document.getElementById('personelFormu').classList.remove('hidden');

            document.getElementById('personelAd').value = personel.ad || '';
            document.getElementById('personelTelefon').value = personel.telefon || '';
            document.getElementById('personelGorev').value = personel.gorev || 'Kasiyer';
            document.getElementById('personelMaas').value = personel.maas || '';
            document.getElementById('personelBaslangic').value = personel.baslangic || '';
            document.getElementById('personelDurum').value = personel.durum || 'Aktif';
            document.getElementById('personelKullanici').value = personel.kullanici || '';
            document.getElementById('personelSifre').value = personel.sifre || '';
        }

        function personelSil(id) {
            if (id === 1) {
                alert('Admin kullanÄ±cÄ±sÄ± silinemez!');
                return;
            }

            if (confirm('Bu personeli silmek istediÄŸinize emin misiniz?')) {
                DB.personeller = DB.personeller.filter(p => p.id !== id);
                saveToStorage();
                loadPersonelTablosu();
                updatePersonelStats();
                alert('Personel silindi!');
            }
        }

        function updatePersonelStats() {
            const toplamPersonel = DB.personeller.length;
            const aktifPersonel = DB.personeller.filter(p => p.durum === 'Aktif').length;

            document.getElementById('toplamPersonel').textContent = toplamPersonel;
            document.getElementById('aktifPersonel').textContent = aktifPersonel;
        }

        // GÃœN SONU Ä°ÅLEMLERÄ°
        function loadGunSonu() {
            const bugun = new Date().toISOString().split('T')[0];
            const bugunSatislar = DB.satislar.filter(s => s.tarih.startsWith(bugun));

            let nakit = 0, kredi = 0, veresiye = 0;

            bugunSatislar.forEach(s => {
                if (s.odemeTipi === 'nakit') nakit += s.toplam;
                else if (s.odemeTipi === 'kredi') kredi += s.toplam;
                else if (s.odemeTipi === 'veresiye') veresiye += s.toplam;
            });

            document.getElementById('gunSonuNakit').textContent = nakit.toFixed(0);
            document.getElementById('gunSonuKredi').textContent = kredi.toFixed(0);
            document.getElementById('gunSonuVeresiye').textContent = veresiye.toFixed(0);
            document.getElementById('gunSonuToplam').textContent = (nakit + kredi + veresiye).toFixed(0);

            const tbody = document.getElementById('gunSonuTablosu');
            tbody.innerHTML = '';

            bugunSatislar.reverse().forEach(satis => {
                const tarih = new Date(satis.tarih);
                const saat = tarih.getHours().toString().padStart(2, '0') + ':' + tarih.getMinutes().toString().padStart(2, '0');
                const musteriAd = satis.musteriId ? 
                    (DB.musteriler.find(m => m.id === parseInt(satis.musteriId))?.ad || 'Bilinmiyor') : 
                    'Misafir';

                let odemeTipi = '';
                if (satis.odemeTipi === 'nakit') odemeTipi = 'ğŸ’µ Nakit';
                else if (satis.odemeTipi === 'kredi') odemeTipi = 'ğŸ’³ Kredi KartÄ±';
                else if (satis.odemeTipi === 'veresiye') odemeTipi = 'ğŸ“‹ Veresiye';

                tbody.innerHTML += `
                    <tr>
                        <td>${saat}</td>
                        <td>${musteriAd}</td>
                        <td>${satis.toplam.toFixed(2)} â‚º</td>
                        <td>${odemeTipi}</td>
                        <td>${satis.personel}</td>
                    </tr>
                `;
            });
        }

        function gunSonuKapat() {
            if (confirm('GÃ¼n sonunu kapatmak istediÄŸinize emin misiniz? Bu iÅŸlem geri alÄ±namaz!')) {
                loadGunSonu();
                alert('GÃ¼n sonu kapatÄ±ldÄ±! Rapor kaydedildi.');
            }
        }

        // RAPORLAR
        function raporOlustur() {
            const raporTipi = document.getElementById('raporTipi').value;
            const baslangic = document.getElementById('raporBaslangic').value;
            const bitis = document.getElementById('raporBitis').value;

            const raporSonuc = document.getElementById('raporSonuc');
            raporSonuc.innerHTML = '';

            if (raporTipi === 'stok') {
                raporSonuc.innerHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>ÃœrÃ¼n</th>
                                <th>Kategori</th>
                                <th>Stok</th>
                                <th>AlÄ±ÅŸ FiyatÄ±</th>
                                <th>SatÄ±ÅŸ FiyatÄ±</th>
                                <th>Kar MarjÄ±</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${DB.urunler.map(u => `
                                <tr>
                                    <td>${u.ad}</td>
                                    <td>${u.kategori}</td>
                                    <td>${u.stok} ${u.birim}</td>
                                    <td>${(u.alisFiyat || 0).toFixed(2)} â‚º</td>
                                    <td>${(u.satisFiyat || 0).toFixed(2)} â‚º</td>
                                    <td>${u.satisFiyat ? ((u.satisFiyat - (u.alisFiyat || 0)) / u.satisFiyat * 100).toFixed(1) : '0.0'}%</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } else if (raporTipi === 'musteri') {
                const borcluMusteriler = DB.musteriler.filter(m => m.borc > 0);
                raporSonuc.innerHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>MÃ¼ÅŸteri</th>
                                <th>Telefon</th>
                                <th>BorÃ§ TutarÄ±</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${borcluMusteriler.map(m => `
                                <tr>
                                    <td>${m.ad}</td>
                                    <td>${m.telefon || '-'}</td>
                                    <td>${(m.borc || 0).toFixed(2)} â‚º</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    <div style="margin-top:20px; text-align:right; font-size:18px; font-weight:700;">
                        Toplam BorÃ§: ${borcluMusteriler.reduce((sum, m) => sum + m.borc, 0).toFixed(2)} â‚º
                    </div>
                `;
            } else {
                // SatÄ±ÅŸ raporlarÄ±
                const filtrelenmis = DB.satislar.filter(s => {
                    const tarih = s.tarih.split('T')[0];
                    return tarih >= baslangic && tarih <= bitis;
                });

                const toplam = filtrelenmis.reduce((sum, s) => sum + s.toplam, 0);

                raporSonuc.innerHTML = `
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">SatÄ±ÅŸ SayÄ±sÄ±</div>
                            <div class="stat-value">${filtrelenmis.length}</div>
                        </div>
                        <div class="stat-card success">
                            <div class="stat-label">Toplam Ciro</div>
                            <div class="stat-value">${toplam.toFixed(0)}â‚º</div>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Tarih</th>
                                <th>MÃ¼ÅŸteri</th>
                                <th>Tutar</th>
                                <th>Ã–deme</th>
                                <th>Personel</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${filtrelenmis.map(s => {
                                const tarih = new Date(s.tarih).toLocaleDateString('tr-TR');
                                const musteriAd = s.musteriId ? 
                                    (DB.musteriler.find(m => m.id === parseInt(s.musteriId))?.ad || 'Bilinmiyor') : 
                                    'Misafir';
                                return `
                                    <tr>
                                        <td>${tarih}</td>
                                        <td>${musteriAd}</td>
                                        <td>${s.toplam.toFixed(2)} â‚º</td>
                                        <td>${s.odemeTipi}</td>
                                        <td>${s.personel}</td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                `;
            }
        }

        function excelIndir(tip) {
            if (tip === 'stok') {
                // Stok verisini Excel'e dÃ¶nÃ¼ÅŸtÃ¼r
                const worksheet_data = [
                    ['Barkod', 'ÃœrÃ¼n AdÄ±', 'Kategori', 'AlÄ±ÅŸ FiyatÄ±', 'SatÄ±ÅŸ FiyatÄ±', 'Stok', 'Kritik Stok', 'Birim']
                ];

                DB.urunler.forEach(urun => {
                    worksheet_data.push([
                        urun.barkod || '',
                        urun.ad,
                        urun.kategori,
                        urun.alisFiyat,
                        urun.satisFiyat,
                        urun.stok,
                        urun.kritikStok,
                        urun.birim
                    ]);
                });

                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.aoa_to_sheet(worksheet_data);
                
                // SÃ¼tun geniÅŸlikleri
                ws['!cols'] = [
                    {wch: 15}, // Barkod
                    {wch: 30}, // ÃœrÃ¼n AdÄ±
                    {wch: 15}, // Kategori
                    {wch: 12}, // AlÄ±ÅŸ FiyatÄ±
                    {wch: 12}, // SatÄ±ÅŸ FiyatÄ±
                    {wch: 10}, // Stok
                    {wch: 12}, // Kritik Stok
                    {wch: 10}  // Birim
                ];

                XLSX.utils.book_append_sheet(wb, ws, "Stok");
                XLSX.writeFile(wb, `Stok_Listesi_${new Date().toISOString().split('T')[0]}.xlsx`);
                alert('Excel dosyasÄ± indirildi!');
            }
        }

        // Rapor Excel indirme fonksiyonu
        function excelIndirRapor() {
            const raporTipi = document.getElementById('raporTipi').value;
            const baslangic = document.getElementById('raporBaslangic').value;
            const bitis = document.getElementById('raporBitis').value;

            let worksheet_data = [];
            let sheetName = 'Rapor';

            if (raporTipi === 'stok') {
                excelIndir('stok');
                return;
            } else if (raporTipi === 'musteri') {
                worksheet_data = [['MÃ¼ÅŸteri', 'Telefon', 'BorÃ§ (â‚º)']];
                DB.musteriler.filter(m => m.borc > 0).forEach(m => {
                    worksheet_data.push([m.ad, m.telefon || '', m.borc]);
                });
                sheetName = 'Musteri_Borclari';
            } else {
                worksheet_data = [['Tarih', 'MÃ¼ÅŸteri', 'Tutar (â‚º)', 'Ã–deme Tipi', 'Personel']];
                const filtrelenmis = DB.satislar.filter(s => {
                    const tarih = s.tarih.split('T')[0];
                    return tarih >= baslangic && tarih <= bitis;
                });
                filtrelenmis.forEach(s => {
                    const tarih = new Date(s.tarih).toLocaleDateString('tr-TR');
                    const musteriAd = s.musteriId ?
                        (DB.musteriler.find(m => m.id === parseInt(s.musteriId))?.ad || 'Bilinmiyor') : 'Misafir';
                    worksheet_data.push([tarih, musteriAd, s.toplam, s.odemeTipi, s.personel]);
                });
                sheetName = 'Satis_Raporu';
            }

            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(worksheet_data);
            XLSX.utils.book_append_sheet(wb, ws, sheetName);
            XLSX.writeFile(wb, `${sheetName}_${new Date().toISOString().split('T')[0]}.xlsx`);
            alert('Excel dosyasÄ± indirildi!');
        }

        // BARKOD OKUMA SÄ°STEMÄ°

        function barkodOkuyucuAc(mod) {
            barkodOkumaModu = mod;
            document.getElementById('scannerOverlay').classList.add('active');
            
            Quagga.init({
                inputStream: {
                    name: "Live",
                    type: "LiveStream",
                    target: document.querySelector('#scanner-viewport'),
                    constraints: {
                        width: 640,
                        height: 480,
                        facingMode: "environment"
                    },
                },
                decoder: {
                    readers: [
                        "ean_reader",
                        "ean_8_reader",
                        "code_128_reader",
                        "code_39_reader",
                        "upc_reader",
                        "upc_e_reader"
                    ]
                }
            }, function(err) {
                if (err) {
                    console.error(err);
                    alert('Kamera eriÅŸimi saÄŸlanamadÄ±! LÃ¼tfen tarayÄ±cÄ± izinlerini kontrol edin.');
                    barkodOkuyucuKapat();
                    return;
                }
                Quagga.start();
                // Her aÃ§Ä±lÄ±ÅŸta listener'Ä± temizle ve yeniden ekle (birden fazla tetikleme Ã¶nlenir)
                Quagga.offDetected(barkodAlgilandi);
                Quagga.onDetected(barkodAlgilandi);
            });
        }

        function barkodOkuyucuKapat() {
            Quagga.stop();
            document.getElementById('scannerOverlay').classList.remove('active');
            barkodOkumaModu = null;
        }

        function barkodAlgilandi(result) {
            const barkod = result.codeResult.code;
            
            // Ses efekti iÃ§in beep
            const beep = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIGmi78OScTgwOUKrk7q1lHAU7k9nwy3krBSF1xe/gljsPE1mu5O+qWBUIRp/h8bllHwcwgdDy1YU1Bxlpu+/cnEwLD1Cr5O+rZRsFPJPZ8Ml2KgUedsXu4JU6DxFYrePwqVkVB0ae4PG5ZB4HMIDPctWENQcZarrw3JxNCw5Qq+XvqWQaBTqS2fDIcykFIHfF7+GWOg8RV6/j8KlZFAZHnt/wuWQcCCyAzvHYijYHGWi67t+bSwsOUKvj7qpkGgU7k9ruyHYpBR53xu7hlDoPE1iu5O+qWBYISaDf8blkHQcsgM7x14s1BhhpuvDfm0wMDlCq5O+pZBsGOpPZ7s11KgUfeM...');
            beep.play().catch(() => {});

            if (barkodOkumaModu === 'kasa') {
                barkodOkuyucuKapat();
                const urun = DB.urunler.find(u => u.barkod === barkod);
                if (urun) {
                    sepeteEkle(urun);
                    alert(`âœ… ${urun.ad} sepete eklendi!`);
                } else {
                    alert(`âŒ Barkod "${barkod}" bulunamadÄ±!`);
                }
            } else if (barkodOkumaModu === 'stok') {
                barkodOkuyucuKapat();
                document.getElementById('urunBarkod').value = barkod;
                alert(`âœ… Barkod okutuldu: ${barkod}`);
            }
        }

        // EXCEL YÃœKLEME SÄ°STEMÄ°
        function excelYukle() {
            document.getElementById('excelYuklemeAlani').classList.remove('hidden');
            document.getElementById('stokFormu').classList.add('hidden');
        }

        function excelYuklemeIptal() {
            document.getElementById('excelYuklemeAlani').classList.add('hidden');
            document.getElementById('excelFileInput').value = '';
            document.getElementById('seciliDosyaAdi').textContent = '';
        }

        function excelDosyasiSec(event) {
            const file = event.target.files[0];
            if (file) {
                document.getElementById('seciliDosyaAdi').textContent = 'ğŸ“„ SeÃ§ilen dosya: ' + file.name;
                excelDosyasiOku(file);
            }
        }

        function excelDosyasiOku(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet, {header: 1});
                    
                    // Ä°lk satÄ±r baÅŸlÄ±k olduÄŸu iÃ§in atla
                    let eklenenSayi = 0;
                    let hataSayi = 0;

                    for (let i = 1; i < jsonData.length; i++) {
                        const row = jsonData[i];
                        
                        // BoÅŸ satÄ±rlarÄ± atla
                        if (!row || row.length === 0 || !row[1]) continue;

                        try {
                            const urun = {
                                id: Date.now() + i,
                                barkod: row[0] ? row[0].toString().trim() : '',
                                ad: row[1] ? row[1].toString().trim() : '',
                                kategori: row[2] ? row[2].toString().trim() : 'DiÄŸer',
                                alisFiyat: parseFloat(row[3]) || 0,
                                satisFiyat: parseFloat(row[4]) || 0,
                                stok: parseInt(row[5]) || 0,
                                kritikStok: parseInt(row[6]) || 10,
                                birim: row[7] ? row[7].toString().trim() : 'Adet'
                            };

                            // Validasyon
                            if (!urun.ad || urun.satisFiyat <= 0) {
                                hataSayi++;
                                continue;
                            }

                            // AynÄ± barkod varsa gÃ¼ncelle, yoksa ekle
                            if (urun.barkod) {
                                const mevcutIndex = DB.urunler.findIndex(u => u.barkod === urun.barkod);
                                if (mevcutIndex >= 0) {
                                    DB.urunler[mevcutIndex] = urun;
                                } else {
                                    DB.urunler.push(urun);
                                }
                            } else {
                                DB.urunler.push(urun);
                            }

                            eklenenSayi++;
                        } catch (err) {
                            hataSayi++;
                            console.error('SatÄ±r hatasÄ±:', err, row);
                        }
                    }

                    saveToStorage();
                    loadStokTablosu();
                    updateStokStats();
                    excelYuklemeIptal();

                    alert(`âœ… Excel yÃ¼kleme tamamlandÄ±!\n\n${eklenenSayi} Ã¼rÃ¼n baÅŸarÄ±yla eklendi/gÃ¼ncellendi.\n${hataSayi} satÄ±rda hata oluÅŸtu.`);

                } catch (error) {
                    console.error('Excel okuma hatasÄ±:', error);
                    alert('âŒ Excel dosyasÄ± okunamadÄ±! LÃ¼tfen dosya formatÄ±nÄ± kontrol edin.');
                }
            };

            reader.readAsArrayBuffer(file);
        }


        // Modal
        function modalAc(baslik, icerik, kapatButonu = true) {
            document.getElementById('modalBaslik').textContent = baslik;
            document.getElementById('modalIcerik').innerHTML = icerik;
            
            const footer = document.getElementById('modalFooter');
            if (kapatButonu) {
                footer.innerHTML = '<button class="btn btn-secondary" onclick="modalKapat()">Kapat</button>';
            } else {
                footer.innerHTML = '';
            }
            
            document.getElementById('modal').classList.add('active');
        }

        function modalKapat() {
            document.getElementById('modal').classList.remove('active');
        }

        // Enter tuÅŸu ile login
        document.getElementById('loginPassword').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                login();
            }
        });
    </script>
</body>
</html>